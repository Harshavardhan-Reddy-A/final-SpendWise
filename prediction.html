<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>prediction.html</title>
    <link rel="stylesheet" href="prediction.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="left-nav-buttons"> 
            <button id="profileBtn" class="header-nav-btn">My Profile</button>
            <button id="homeBtn" class="header-nav-btn">Upload Data</button>
        </div>
        <div class="header-title">SpendWise</div>
        <div class="nav-buttons">
            <button id="manageBtn" class="header-nav-btn">Manager</button>
            <button id="analyzeBtn" class="header-nav-btn">Analysis</button>
            <button id="predictBtn" class="header-nav-btn">Prediction</button>
        </div>
    </header>

    <div class="container">
        <aside class="sidebar">
            <div class="prediction-select">
                <div class="period-item">
                    <label for="forecastMonth">Month to Forecast:</label>
                    <input type="text" id="forecastMonth" value="Next Month" disabled>
                    <label for="forecastYear">Annual Projection:</label>
                    <input type="text" id="forecastYear" value="Next Year" disabled>
                    <button id="runForecastBtn">Run Linear Regression Forecast</button>
                </div>
            </div>
        </aside>

        <main class="main-area">
            <h2 id="predictionTitle">Spending Forecast</h2>
            
            <div class="card full-width"> 
                <h3 id="resultsCardTitle">Linear Regression Forecast Results</h3>
                <div id="predictionResultContent">
                    </div>
            </div>
            
            <div class="card full-width" id="modelDetailsCard"> 
                <h3>Model Rationale: Simple Linear Regression</h3>
                <div id="modelDetailsContent">
                    <p>
                        This forecast uses a **Pure JavaScript Linear Regression Model** applied to each category's historical spending data. This provides a clear, mathematically sound, category-specific projection based on past trends.
                    </p>
                    <p>
                        **Model Structure:**
                        <ul>
                            <li>**Method:** Simple Linear Regression ($\$$y = mx + b$$\$).</li>
                            <li>**Input (x):** Global Month Sequence Number (e.g., $\$$1, 2, 3, \dots$$\$).</li>
                            <li>**Output (y):** Predicted Monthly Spending for the specific category.</li>
                        </ul>
                    </p>
                </div>
            </div>
        </main>
    </div>

    <script type="module" src="prediction.js"></script>
    <script type="module">
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Navigation redirects & Auth Guard
        document.getElementById('profileBtn').addEventListener('click', () => { window.location.href = 'profile.html'; });
        document.getElementById('homeBtn').addEventListener('click', () => { window.location.href = 'upload.html'; }); // UPDATED
        document.getElementById("manageBtn").addEventListener("click", () => { window.location.href = "manager.html"; });
        document.getElementById("analyzeBtn").addEventListener("click", () => { window.location.href = "analysis.html"; });
        document.getElementById("predictBtn").addEventListener("click", () => { window.location.href = "prediction.html"; });

        // Dynamic Logout Button Creation (Standard across all content pages)
        window.onload = () => {
            try {
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);
                
                onAuthStateChanged(auth, (user) => {
                    const navButtons = document.querySelector('.nav-buttons');
                    let logoutBtn = document.getElementById('logoutBtn');
                    
                    if (!user || !user.email) {
                        if (!localStorage.getItem('currentUser')) {
                            window.location.href = 'index.html'; // UPDATED REDIRECT
                        }
                    } else {
                        if (!logoutBtn) {
                           logoutBtn = document.createElement('button');
                           logoutBtn.id = 'logoutBtn';
                           logoutBtn.className = 'header-nav-btn';
                           logoutBtn.textContent = 'Sign Out';
                           navButtons.appendChild(logoutBtn);
                           
                           logoutBtn.addEventListener('click', async () => {
                               await signOut(auth);
                               localStorage.removeItem('currentUser');
                           });
                        }
                    }
                });
            } catch (error) {
                console.warn("Firebase check failed. Ensure Firebase config is available.");
                 if (!localStorage.getItem('currentUser')) {
                    setTimeout(() => { 
                        if (!localStorage.getItem('currentUser')) {
                            window.location.href = 'index.html'; // UPDATED REDIRECT
                        }
                    }, 500);
                }
            }
        };
    </script>
</body>
</html>